var investorNameSelect=document.querySelector(".investor-name"),investAmountWrapper=document.querySelector(".invest-amount-wrapper"),investAmountInput=document.querySelector(".invest-amount"),showBondsBtn=document.querySelector(".show-bonds-btn"),bondsContainer=document.querySelector(".bonds-container"),bondItem=document.querySelector(".bond"),investorsContainer=document.querySelector(".investors-container"),modalOverlay=document.querySelector(".modal-overlay"),modal=document.querySelector(".modal"),modalHeader=document.querySelector(".modal__header"),modalCloseBtn=document.querySelector(".modal__close-btn"),modalBodyInner=document.querySelector(".modal__body-inner");function bondsLoader(){showBondsBtn.textContent="Finding available bonds...",bondsContainer.innerHTML='<div class="loader">Loading</div><div class="loader">Loading</div>'}function investorsLoader(t){t.innerHTML='<div class="loader">Loading</div>'}function focusClassToggle(){investAmountWrapper.classList.toggle("invest-amount-wrapper--focus")}function currencyFormat(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function capitaliseFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}function getBonds(){var t=new XMLHttpRequest;t.open("GET","http://165.227.229.49:8000/bonds?api_key=vNtV4nZsuMRL01sXVPzUtRnzf7L08B9O",!0),t.setRequestHeader("Accept","application/json"),t.onload=function(){if(200==t.status){var e=JSON.parse(t.responseText).data,n=100*Number(investAmountInput.value);showBondsBtn.textContent="Show available bonds",bondsContainer.innerHTML="";for(var a=0;a<e.length;a++){var o=Number(100*e[a].maturity_interest).toFixed(2),s=n+n*e[a].maturity_interest/12*e[a].duration_months,r=currencyFormat(Number(s/100).toFixed(2)),i=Number(100*e[a].quarterly_interest).toFixed(2),c=n+n*e[a].quarterly_interest/12*e[a].duration_months,d=currencyFormat(Number(c/100).toFixed(2));bondsContainer.innerHTML+='<div class="bond">\n          <header class="bond-header">\n            <h2 class="bond__heading">'.concat(e[a].name,'</h2>\n            <p class="bond__duration">Duration | <span>').concat(e[a].duration_months,' Months</span></p>\n          </header>\n          <div class="bond-type-container">\n            <div class="bond-type bond-type--maturity">\n              <div class="bond-type__interest">\n                <p class="bond-type__interest-percent">').concat(o,'%<span class="bond-type__pa"> P.A</span></p>\n                <p class="bond-type__interest-paid">Interest paid <strong>on maturity</strong></p>\n              </div>\n              <div class="bond-type__return">\n                <p class="bond-type__return-amount">£').concat(r,'</p>\n                <p class="bond-type__return-text"><strong>Expected gross return</strong><br><i>(based on a £').concat(currencyFormat(investAmountInput.value),' investment)</i></p>\n              </div>\n              <div class="bond-type__invest-btn-wrapper">\n                <button class="btn bond-type__invest-btn" data-investor-name="').concat(investorNameSelect.options[[investorNameSelect.selectedIndex]].text,'" data-bond-name="').concat(e[a].name,'" data-bond-id="').concat(e[a].id,'" data-bond-type="quarterly" data-invest-amount="').concat(n,'">Invest<span class="u-screen-reader-text"> in ').concat(e[a].name," over ").concat(e[a].duration_months,' months, interest paid on maturity.</span></button>\n              </div>\n            </div>\n            <div class="bond-type bond-type--quarterly">\n              <div class="bond-type__interest">\n                <p class="bond-type__interest-percent">').concat(i,'%<span class="bond-type__pa"> P.A</span></p>\n                <p class="bond-type__interest-paid">Interest paid <strong>quarterly</strong></p>\n              </div>\n              <div class="bond-type__return">\n                <p class="bond-type__return-amount">£').concat(d,'</p>\n                <p class="bond-type__return-text"><strong>Expected gross return</strong><br><i>(based on a £').concat(currencyFormat(investAmountInput.value),' investment)</i></p>\n              </div>\n              <div class="bond-type__invest-btn-wrapper">\n                <button class="btn bond-type__invest-btn" data-investor-name="').concat(investorNameSelect.options[[investorNameSelect.selectedIndex]].text,'" data-bond-name="').concat(e[a].name,'" data-bond-id="').concat(e[a].id,'" data-bond-type="quarterly" data-invest-amount="').concat(n,'">Invest<span class="u-screen-reader-text"> in ').concat(e[a].name," over ").concat(e[a].duration_months," months, interest paid quarterly.</span></button>\n              </div>\n            </div>\n          </div>\n        </div>\n        \x3c!-- END .bond --\x3e")}var l=document.querySelectorAll(".bond-type__invest-btn");Array.prototype.slice.call(l).forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var e=investorNameSelect.value,n=this.getAttribute("data-investor-name"),a=this.getAttribute("data-bond-name"),o=this.getAttribute("data-bond-id"),s=this.getAttribute("data-bond-type"),r=this.getAttribute("data-invest-amount");if(!confirm("Are you sure you want to make the following investment?\nName: ".concat(n,"\nInvestment Amount: £").concat(currencyFormat(Number(r/100).toFixed(2)),"\nBond Name: ").concat(a)))return!1;makeInvestment(e,o,s,r)}))})),setTimeout((function(){var t=document.querySelectorAll(".bond");Array.prototype.slice.call(t).forEach((function(t){t.classList.add("is-loaded")}))}),100)}},t.send()}function getInvestorsName(){var t=new XMLHttpRequest;t.open("GET","http://165.227.229.49:8000/investors?&per_page=50&api_key=vNtV4nZsuMRL01sXVPzUtRnzf7L08B9O",!0),t.setRequestHeader("Accept","application/json"),t.onload=function(){if(200==t.status){var e=JSON.parse(t.responseText).data;investorNameSelect.innerHTML="<option value='0'>Select investor</option>";for(var n=0;n<e.length;n++){var a=document.createElement("option");a.setAttribute("value",e[n].id),a.textContent="".concat(e[n].first_name," ").concat(e[n].last_name),investorNameSelect.appendChild(a)}}},t.send()}function getInvestors(){investorsLoader(investorsContainer);var t=new XMLHttpRequest;t.open("GET","http://165.227.229.49:8000/investors?&per_page=50&api_key=vNtV4nZsuMRL01sXVPzUtRnzf7L08B9O",!0),t.setRequestHeader("Accept","application/json"),t.onload=function(){if(200==t.status){var e=JSON.parse(t.responseText).data;investorsContainer.innerHTML="";for(var n=0;n<e.length;n++)investorsContainer.innerHTML+='\n          <div class="investor">\n            <div class="investor__avatar">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                <title>Avatar image for '.concat(e[n].first_name," ").concat(e[n].last_name,'</title>\n                <path d="M12,0A12,12,0,1,1,0,12,12,12,0,0,1,12,0Zm8.13,19.41a2.6,2.6,0,0,0-1.63-.85c-3.85-.91-4.09-1.5-4.35-2.06a2.18,2.18,0,0,1,.21-2c1.72-3.25,2.09-6,1-7.79A3.74,3.74,0,0,0,12,5,3.79,3.79,0,0,0,8.59,6.76c-1.07,1.79-.69,4.55,1.05,7.76a2.16,2.16,0,0,1,.22,2c-.27.59-.61,1.19-4.37,2.07a2.54,2.54,0,0,0-1.62.85,11,11,0,0,0,16.26,0Zm.65-.78a11,11,0,1,0-17.56,0,3.82,3.82,0,0,1,2-1.05c2-.46,3.38-.83,3.68-1.5A1.24,1.24,0,0,0,8.76,15c-1.92-3.54-2.28-6.65-1-8.75A4.79,4.79,0,0,1,12,4a4.79,4.79,0,0,1,4.24,2.22c1.25,2.08.9,5.19-1,8.77a1.27,1.27,0,0,0-.18,1.1c.31.66,1.64,1,3.67,1.49A3.76,3.76,0,0,1,20.78,18.63Z" fill="#63a1d4"/>\n              </svg>\n            </div>\n            <h2 class="investor__name">').concat(e[n].first_name," ").concat(e[n].last_name,'</h2>\n              <button class="investor__investments" data-investor-id="').concat(e[n].id,'" data-investor-name="').concat(e[n].first_name," ").concat(e[n].last_name,'">View Investments<span class="u-screen-reader-text"> for ').concat(e[n].first_name," ").concat(e[n].last_name,"</span></button>\n          </div>");var a=document.querySelectorAll(".investor__investments");Array.prototype.slice.call(a).forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var e=this.getAttribute("data-investor-id"),n=this.getAttribute("data-investor-name");openModal(),getInvestments(e,n)}))})),setTimeout((function(){var t=document.querySelectorAll(".investor");Array.prototype.slice.call(t).forEach((function(t){t.classList.add("is-loaded")}))}),100)}},t.send()}function getInvestments(t,e){investorsLoader(modalBodyInner);var n=new XMLHttpRequest,a="http://165.227.229.49:8000/investors/".concat(t,"/investments?api_key=vNtV4nZsuMRL01sXVPzUtRnzf7L08B9O");n.open("GET",a,!0),n.setRequestHeader("Accept","application/json"),n.onload=function(){if(200==n.status){var t=JSON.parse(n.responseText),a=t.data,o=t.total;if(o>0){modalHeader.innerHTML='\n        <div class="investments">\n          <div class="investments__avatar">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n              <title>Avatar image for '.concat(a[0].investor.first_name," ").concat(a[0].investor.last_name,'</title>\n              <path d="M12,0A12,12,0,1,1,0,12,12,12,0,0,1,12,0Zm8.13,19.41a2.6,2.6,0,0,0-1.63-.85c-3.85-.91-4.09-1.5-4.35-2.06a2.18,2.18,0,0,1,.21-2c1.72-3.25,2.09-6,1-7.79A3.74,3.74,0,0,0,12,5,3.79,3.79,0,0,0,8.59,6.76c-1.07,1.79-.69,4.55,1.05,7.76a2.16,2.16,0,0,1,.22,2c-.27.59-.61,1.19-4.37,2.07a2.54,2.54,0,0,0-1.62.85,11,11,0,0,0,16.26,0Zm.65-.78a11,11,0,1,0-17.56,0,3.82,3.82,0,0,1,2-1.05c2-.46,3.38-.83,3.68-1.5A1.24,1.24,0,0,0,8.76,15c-1.92-3.54-2.28-6.65-1-8.75A4.79,4.79,0,0,1,12,4a4.79,4.79,0,0,1,4.24,2.22c1.25,2.08.9,5.19-1,8.77a1.27,1.27,0,0,0-.18,1.1c.31.66,1.64,1,3.67,1.49A3.76,3.76,0,0,1,20.78,18.63Z" fill="#63a1d4"/>\n            </svg>\n          </div>\n          <h3 class="investments__name">').concat(a[0].investor.first_name," ").concat(a[0].investor.last_name,'</h3>\n          <div class="investments__total">').concat(o>1?o+" investments":o+" investment","</div>\n        </div>"),modalBodyInner.innerHTML="";for(var s=0;s<a.length;s++)"committed"===a[s].status||"cancelled"===a[s].status?modalBodyInner.innerHTML+='\n            <div class="investment">\n              <h4 class="investment__bond-name">'.concat(a[s].bond.name,"</h4>\n              <p><b>Duration:</b> ").concat(a[s].bond.duration_months," months</p>\n              <p><b>Interest Paid:</b> ").concat(capitaliseFirst(a[s].type),"</p>\n              <p><b>Amount Invested:</b> £").concat(currencyFormat(Number(a[s].amount/100).toFixed(2)),"</p>\n              <p><b>Expected Return:</b> £").concat(currencyFormat(Number(a[s].expected_return/100).toFixed(2)),"</p>\n              <p><b>Status:</b> ").concat(capitaliseFirst(a[s].status)," </p>\n            </div>"):modalBodyInner.innerHTML+='\n            <div class="investment">\n              <h4 class="investment__bond-name">'.concat(a[s].bond.name,"</h4>\n              <p><b>Duration:</b> ").concat(a[s].bond.duration_months," months</p>\n              <p><b>Interest Paid:</b> ").concat(capitaliseFirst(a[s].type),"</p>\n              <p><b>Amount Invested:</b> £").concat(currencyFormat(Number(a[s].amount/100).toFixed(2)),"</p>\n              <p><b>Expected Return:</b> £").concat(currencyFormat(Number(a[s].expected_return/100).toFixed(2)),"</p>\n              <p><b>Status:</b> ").concat(capitaliseFirst(a[s].status),' </p>\n              <button class="investment__cancel-btn" data-bond-name="').concat(a[s].bond.name,'" data-investor-name="').concat(a[s].investor.first_name," ").concat(a[s].investor.last_name,'" data-investor-id="').concat(a[s].investor_id,'" data-investment-id="').concat(a[s].id,'">Cancel investment</button>\n            </div>')}else modalHeader.innerHTML='\n        <div class="investments">\n          <div class="investments__avatar">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n              <title>Avatar image for '.concat(e,'</title>\n              <path d="M12,0A12,12,0,1,1,0,12,12,12,0,0,1,12,0Zm8.13,19.41a2.6,2.6,0,0,0-1.63-.85c-3.85-.91-4.09-1.5-4.35-2.06a2.18,2.18,0,0,1,.21-2c1.72-3.25,2.09-6,1-7.79A3.74,3.74,0,0,0,12,5,3.79,3.79,0,0,0,8.59,6.76c-1.07,1.79-.69,4.55,1.05,7.76a2.16,2.16,0,0,1,.22,2c-.27.59-.61,1.19-4.37,2.07a2.54,2.54,0,0,0-1.62.85,11,11,0,0,0,16.26,0Zm.65-.78a11,11,0,1,0-17.56,0,3.82,3.82,0,0,1,2-1.05c2-.46,3.38-.83,3.68-1.5A1.24,1.24,0,0,0,8.76,15c-1.92-3.54-2.28-6.65-1-8.75A4.79,4.79,0,0,1,12,4a4.79,4.79,0,0,1,4.24,2.22c1.25,2.08.9,5.19-1,8.77a1.27,1.27,0,0,0-.18,1.1c.31.66,1.64,1,3.67,1.49A3.76,3.76,0,0,1,20.78,18.63Z" fill="#63a1d4"/>\n            </svg>\n          </div>\n          <h3 class="investments__name">').concat(e,"</h3>\n        </div>"),modalBodyInner.innerHTML='\n          <div class="investment investment--none">\n            <p>No investments have been made yet</p>\n          </div>';var r=document.querySelectorAll(".investment__cancel-btn");Array.prototype.slice.call(r).forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var e=this.getAttribute("data-bond-name"),n=this.getAttribute("data-investor-id"),a=(this.getAttribute("data-investor-name"),this.getAttribute("data-investment-id"));if(!confirm("Are you sure you want to cancel your investment with ".concat(e,"?")))return!1;cancelInvestment(n,a)}))}))}},n.send()}function makeInvestment(t,e,n,a){var o=new XMLHttpRequest,s="http://165.227.229.49:8000/investors/"+t+"/investments?api_key=vNtV4nZsuMRL01sXVPzUtRnzf7L08B9O",r=JSON.stringify({bond_id:Number(e),type:n,amount:Number(a)});o.open("POST",s,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json"),o.onload=function(){o.status>=400?(alert("Sorry your investment was not successful, please try again later."),console.log("Response from the server: ".concat(o.responseText)),console.log("Data sent to server: ".concat(r))):(alert("Your investment was made successfully!"),console.log("Response from the server: ".concat(o.responseText)),console.log("Data sent to server: ".concat(r)))},o.send(r)}if(investorNameSelect&&investorNameSelect.addEventListener("change",(function(){investAmountInput.value&&""!=bondsContainer.innerHTML&&(bondsContainer.style="margin-top: 5rem;",bondsLoader(),getBonds())})),investAmountInput&&investAmountInput.addEventListener("change",(function(){""!=bondsContainer.innerHTML&&showBondsBtn.click()})),showBondsBtn&&showBondsBtn.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,0==investorNameSelect.value?alert("Please choose an investor."):investAmountInput.value?(bondsContainer.style="margin-top: 5rem;",bondsLoader(),getBonds()):alert("Please specify an investment amount.")})),modalOverlay&&modalCloseBtn){function openModal(){modalOverlay.style.opacity="1",modalOverlay.style.visibility="visible"}function closeModal(){modalOverlay.style.opacity="0",modalOverlay.style.visibility="hidden",setTimeout(()=>{modalHeader.innerHTML="",modalBodyInner.innerHTML=""},300)}modalOverlay.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,closeModal()})),modal.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation()})),modalCloseBtn.addEventListener("click",(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,closeModal()}))}function cancelInvestment(t,e){var n=new XMLHttpRequest,a="http://165.227.229.49:8000/investors/".concat(t,"/investments/").concat(e,"?api_key=vNtV4nZsuMRL01sXVPzUtRnzf7L08B9O");n.open("DELETE",a,!0),n.setRequestHeader("Accept","application/json"),n.onload=function(){if(200==n.status){var t=JSON.parse(n.responseText);console.log(t),closeModal(),alert("Your investment has been successfully cancelled.")}else{t=JSON.parse(n.responseText);console.log(t)}},n.send()}investorNameSelect&&getInvestorsName(),investorsContainer&&getInvestors();